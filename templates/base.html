<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>{{ title or "REP" }}</title>

    <!-- A√±adido: Bootstrap 5 CSS (CDN) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- A√±adido: CSS personalizado separado -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
  </head>
  <body>
    <!-- HEADER / NAV -->
    <div class="header">
      {% if current_user.is_authenticated %}
      <div class="header__left">
        <a class="brand-link" href="/">
          <div class="brand-logo" role="img" aria-label="Logo"></div>
          <div class="brand-meta">
            <span class="brand-name">SIEST</span>
            <span class="brand-sub">Gesti√≥n integral</span>
          </div>
        </a>
      </div>

      <div class="header__right">
        <div class="user-chip" aria-label="Datos del usuario">
          <div class="user-avatar">{{ (current_user.name or 'U')[:1]|upper }}{{ (current_user.lastname or 'S')[:1]|upper }}</div>
          <div class="user-meta">
            <span class="user-name">{{ current_user.name }} {{ current_user.lastname }}</span>
            <span class="user-id">{{ current_user.codcas or 'Sin c√≥digo' }}</span>
          </div>
          <span class="role-chip">{{ current_user.role|capitalize }}</span>
        </div>

        <div class="header__actions">
          <a class="pill-btn pill-btn--primary" href="/">Inicio</a>
          {% if current_user.role == 'admin' %}
          <a class="pill-btn pill-btn--primary" href="{{ url_for('main.register') }}">Agregar usuario</a>
          {% endif %}
          <a class="pill-btn pill-btn--ghost" href="/logout">Cerrar sesi√≥n</a>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- MENSAJES FLASH (ahora centrados en la parte superior) -->
    {% with messages = get_flashed_messages(with_categories=True) %} {% if
    messages %}
    <div class="flash-container" aria-live="polite" aria-atomic="true">
      {% for category, msg in messages %} {% if category == 'danger' %} {% set
      cls = 'danger' %} {% elif category == 'warning' %} {% set cls = 'warning'
      %} {% elif category == 'success' %} {% set cls = 'success' %} {% else %}
      {% set cls = 'info' %} {% endif %}
      <div
        class="alert alert-{{ cls }} alert-dismissible fade show flash-floating"
        role="alert"
      >
        {{ msg }}
      </div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %}

    <!-- CONTENIDO PRINCIPAL -->
    {% if current_user.is_authenticated %} {% if show_modules|default(True) %}
    <div class="main">
      <div class="modules-container">
        <div class="modules-header" style="color:#ffffff;">
          <h1 class="modules-title">M√≥dulos disponibles</h1>
          <p class="modules-subtitle">Accede a los diferentes servicios de la plataforma</p>
        </div>
        <div class="modules-menu">
        <!-- M√≥dulo 1: Dashboard (activo) -->
        <a
          href="{{ '/dashboard/' + (current_user.dashboard_code() if current_user else '') }}"
          class="module"
        >
          <img
            src="{{ url_for('static', filename='RCS2.png') }}"
            alt="Dashboard"
          />
          <span>Consulta externa</span>
        </a>

        <!-- M√≥dulo 2: Emergencia (activar si existe c√≥digo del usuario) -->
        {% set code_alt = current_user.dashboard_code() if current_user else ''
        %} {% if code_alt %}
        <a href="{{ '/dashboard_alt/' + code_alt + '/' }}" class="module">
          <img
            src="{{ url_for('static', filename='RSC1.png') }}"
            alt="Emergencia"
          />
          <span>Emergencia</span>
        </a>
        {% else %}
        <div class="module inactive">
          <img
            src="{{ url_for('static', filename='RSC1.png') }}"
            alt="M√≥dulo 2"
          />
          <span>Emergencia</span>
        </div>
        {% endif %}

        <!-- M√≥dulo 3: Hospitalizaci√≥n (desactivado) -->
        <div class="module inactive">
          <img
            src="{{ url_for('static', filename='hospitalizacion.png') }}"
            alt="Hospitalizaci√≥n"
          />
          <span>Hospitalizaci√≥n</span>
        </div>

        <!-- M√≥dulo 4: Laboratorio (desactivado) -->
        <div class="module inactive">
          <img
            src="{{ url_for('static', filename='cirugia.png') }}"
            alt="Centro quir√∫rgico"
          />
          <span>Centro quir√∫rgico</span>
        </div>

        <!-- M√≥dulo 5: reportes gerenciales -->
        {% if current_user.role == 'admin' %}
        <a href="{{ url_for('main.reportes_gerenciales') }}" class="module">
          <img
            src="{{ url_for('static', filename='analytics.png') }}"
            alt="Reportes gerenciales"
          />
          <span>Reportes gerenciales</span>
        </a>
        {% endif %}

        <!-- M√≥dulo 6: reportes LOGS - ADMIN -->
        {% if current_user.role == 'admin' %}
        <a href="{{ url_for('logs.view_logs') }}" class="module">
          <img
            src="{{ url_for('static', filename='logs.png') }}"
            alt="Reportes LOGS"
          />
          
          <span>Auditor√≠a del Sistema</span>
        </a>
        {% endif %}

        <!-- Los gr√°ficos de auditor√≠a ahora est√°n integrados en Reportes LOGS -->
        
      </div>
      </div>
    </div>

    {% endif %} {% else %}

    <div class="main">
      <!-- logo superior derecho en pantalla de login -->
      <div class="login-top-logo" role="img" aria-label="Logoes"></div>

      <!-- LOGIN FORM con logo a la izquierda-centro -->
      <div class="login-wrapper">
        <div class="login-logo">
          <img
            src="{{ url_for('static', filename='SIEST.png') }}"
            alt="SIEST - Sistema Integral de Estad√≠sticas"
          />
        </div>
        <div class="container">
          <h2>üîê Acceso</h2>
          <p class="small">Ingresa tus credenciales para acceder a la plataforma</p>
          <form method="post" action="/login" novalidate>
            <!-- Campo Usuario -->
            <div class="field" aria-hidden="false">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <path
                  d="M12 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M3.6 20.4a8.4 8.4 0 0 1 16.8 0"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <div class="input-wrap">
                <input
                  type="text"
                  name="username"
                  placeholder="Usuario"
                  aria-label="Usuario"
                  autocomplete="username"
                  required
                />
              </div>
            </div>

            <!-- Campo Contrase√±a -->
            <div class="field">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <rect
                  x="3"
                  y="11"
                  width="18"
                  height="10"
                  rx="2"
                  stroke="currentColor"
                  stroke-width="1.5"
                />
                <path
                  d="M7 11V8a5 5 0 0 1 10 0v3"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <div class="input-wrap">
                <input
                  type="password"
                  name="password"
                  placeholder="Contrase√±a"
                  aria-label="Contrase√±a"
                  autocomplete="current-password"
                  required
                />
              </div>
            </div>

            <!-- Controles -->
            <div class="controls">
              <label>
                <input
                  type="checkbox"
                  name="remember"
                  aria-label="Recordarme en este navegador"
                />
                <span>Recordarme</span>
              </label>
            </div>

            <!-- Bot√≥n Ingresar -->
            <button type="submit">Ingresar ‚Üí</button>

            <!-- Enlace de soporte -->
            <div class="secondary-link">
              ¬øNecesitas ayuda? <strong>Contacta con soporte</strong>
            </div>
          </form>
        </div>
      </div>
    </div>
    {% endif %} {% block body %}{% endblock %}

    <!-- A√±adido: Bootstrap JS bundle + peque√±o script para auto-cerrar alertas -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
